<!-- === FORMULARIO CON HORAS DISPONIBLES === -->
<section id="agendar" class="formulario-cita">
  <h2>Agendar Cita</h2>
  <p>Selecciona el servicio, elige una hora disponible y deja tus datos üíà</p>

  <form id="formCita">
      <input type="text" id="nombre" placeholder="Tu nombre" required>
      <input type="tel" id="telefono" placeholder="Tu n√∫mero de tel√©fono" required>
      
      <select id="servicio" required>
          <option value="">Selecciona un servicio</option>
          <option value="Corte">Corte</option>
          <option value="Cejas">Cejas</option>
          <option value="Barba">Barba</option>
          <option value="Mascarilla 5 pasos">Mascarilla 5 pasos</option>
      </select>

      <input type="date" id="fecha" required>
      
      <select id="hora" required>
          <option value="">Selecciona una hora</option>
          <!-- Se llena autom√°ticamente desde Google Sheets -->
      </select>

      <button type="submit"><i class="fa-solid fa-calendar-check"></i> Reservar cita</button>
  </form>

  <p id="estado" style="margin-top:15px;"></p>
</section>

<script>
const SHEET_URL = "https://script.google.com/u/0/home/projects/11LUvaMSB26mag1mR0M29rOFQEXGSycD7CAiLcHgbH3AcAjfgkVlN7lrC/edit"; // ‚Üê rempl√°zalo por tu URL de Google Apps Script

async function cargarHoras() {
  const fecha = document.getElementById("fecha").value;
  const selectHora = document.getElementById("hora");
  selectHora.innerHTML = "<option value=''>Cargando horas...</option>";

  if (!fecha) return;

  const res = await fetch(`${SHEET_URL}?fecha=${fecha}`);
  const horasOcupadas = await res.json();

  const horas = [
    "9:00 AM", "10:00 AM", "11:00 AM", "12:00 PM",
    "1:00 PM", "2:00 PM", "3:00 PM", "4:00 PM", "5:00 PM"
  ];

  selectHora.innerHTML = "";
  horas.forEach(h => {
    const option = document.createElement("option");
    option.value = h;
    option.textContent = h;
    if (horasOcupadas.includes(h)) {
      option.disabled = true;
      option.textContent += " (Ocupado)";
    }
    selectHora.appendChild(option);
  });
}

document.getElementById("fecha").addEventListener("change", cargarHoras);

document.getElementById("formCita").addEventListener("submit", async e => {
  e.preventDefault();
  const data = {
    nombre: nombre.value,
    telefono: telefono.value,
    servicio: servicio.value,
    fecha: fecha.value,
    hora: hora.value
  };

  document.getElementById("estado").textContent = "Enviando...";
  const res = await fetch(SHEET_URL, {
    method: "POST",
    body: JSON.stringify(data)
  });

  const text = await res.text();
  document.getElementById("estado").textContent = text.includes("OK") ? 
    "‚úÖ Cita registrada con √©xito" : "‚ùå Error al registrar la cita";
});
</script>
